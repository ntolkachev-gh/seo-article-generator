<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Article Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // Fallback –¥–ª—è marked.js –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π CDN –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
        if (typeof marked === 'undefined') {
            console.log('–û—Å–Ω–æ–≤–Ω–æ–π CDN marked –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/marked@4.3.0/marked.min.js';
            script.onerror = function() {
                console.log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π CDN marked —Ç–∞–∫–∂–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥');
            };
            document.head.appendChild(script);
        }
    </script>
    <style>
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –≤—Å–µ –æ—Ç—Å—Ç—É–ø—ã */
        body {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã —É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        * {
            box-sizing: border-box;
        }
        
        .loading {
            display: none;
        }
        .loading.show {
            display: block;
        }
        .error {
            color: #dc2626;
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin: 1rem 0;
        }
        .success {
            color: #059669;
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <div class="flex-1 px-0 sm:px-1 md:px-2 py-1 sm:py-2 md:py-3">
        <!-- Header -->
        <header class="text-center mb-2 sm:mb-3 md:mb-4">
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-1 sm:mb-2">SEO Article Generator</h1>
            <p class="text-sm sm:text-base text-gray-600">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π —Å –ø–æ–º–æ—â—å—é AI</p>
        </header>

        <!-- Navigation -->
        <nav class="flex justify-center mb-2 sm:mb-3 md:mb-4">
            <div class="bg-white rounded-lg shadow p-1">
                <button id="nav-generate" class="px-3 sm:px-4 py-2 rounded-md bg-blue-600 text-white font-medium text-sm sm:text-base">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è</button>
                <button id="nav-history" class="px-3 sm:px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100 text-sm sm:text-base">–ò—Å—Ç–æ—Ä–∏—è</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1">
            <!-- Generation Form -->
            <div id="generation-form" class="max-w-lg sm:max-w-xl md:max-w-2xl mx-auto">
                <div class="bg-white rounded-lg shadow p-3 sm:p-4 md:p-6">
                    <h2 class="text-xl sm:text-2xl font-semibold mb-3 sm:mb-4 md:mb-6">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é</h2>
                    
                    <form id="article-form" class="space-y-2 sm:space-y-3 md:space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">–¢–µ–º–∞ —Å—Ç–∞—Ç—å–∏</label>
                            <input type="text" id="topic" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm sm:text-base"
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ—É—á—à–∏–µ —Å–ø–æ—Å–æ–±—ã –ø–æ—Ö—É–¥–µ–Ω–∏—è">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">–¢–µ–∑–∏—Å—ã</label>
                            <textarea id="thesis" rows="3" sm:rows="4" required
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm sm:text-base"
                                      placeholder="–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–∑–∏—Å—ã –∏ –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã —Å—Ç–∞—Ç—å–∏..."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">–ü—Ä–∏–º–µ—Ä—ã —Å—Ç–∏–ª—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <textarea id="styleExamples" rows="4" sm:rows="6"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm sm:text-base"
                                      placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–æ–≤, —Å—Ç–∏–ª—å –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Å—Ç–∞—Ç—å–∏..."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞–∫–æ–≤</label>
                            <select id="characterCount" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm sm:text-base">
                                <option value="2000">2000 –∑–Ω–∞–∫–æ–≤ (–∫–æ—Ä–æ—Ç–∫–∞—è —Å—Ç–∞—Ç—å—è)</option>
                                <option value="5000" selected>5000 –∑–Ω–∞–∫–æ–≤ (—Å—Ä–µ–¥–Ω—è—è —Å—Ç–∞—Ç—å—è)</option>
                                <option value="8000">8000 –∑–Ω–∞–∫–æ–≤ (–¥–ª–∏–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è)</option>
                                <option value="12000">12000 –∑–Ω–∞–∫–æ–≤ (–æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">–ú–æ–¥–µ–ª—å</label>
                            <select id="model" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm sm:text-base">
                                <!-- –ë—ã—Å—Ç—Ä—ã–µ –º–æ–¥–µ–ª–∏ -->
                                <optgroup label="üöÄ –ë—ã—Å—Ç—Ä—ã–µ">
                                    <option value="gpt-4o-mini">GPT-4o Mini - –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏ –¥–µ—à–µ–≤—ã–π</option>
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo - –ë—ã—Å—Ç—Ä—ã–π –∏ —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–π</option>
                                    <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku - –ë—ã—Å—Ç—Ä—ã–π –∏ –¥–µ—à–µ–≤—ã–π</option>
                                </optgroup>
                                
                                <!-- –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ -->
                                <optgroup label="‚öñÔ∏è –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ">
                                    <option value="gpt-4o" selected>GPT-4o - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ</option>
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet - –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ</option>
                                </optgroup>
                                
                                <!-- –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ -->
                                <optgroup label="‚≠ê –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ">
                                    <option value="gpt-4">GPT-4 - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ</option>
                                    <option value="claude-3-sonnet-20240229">Claude 3 Sonnet - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ GPT-4</option>
                                </optgroup>
                                
                                <!-- –ü—Ä–µ–º–∏—É–º -->
                                <optgroup label="üëë –ü—Ä–µ–º–∏—É–º">
                                    <option value="claude-3-opus-20240229">Claude 3 Opus - –ü—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ</option>
                                    <option value="gpt-4-32k">GPT-4 32K - –î–ª–∏–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <button type="submit" 
                                class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 font-medium text-sm sm:text-base">
                            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é
                        </button>
                    </form>
                    
                    <div id="loading" class="loading text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                        <p class="mt-2 text-gray-600">–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç–∞—Ç—å—é...</p>
                    </div>
                    
                    <div id="error-message" class="error" style="display: none;"></div>
                </div>
            </div>

            <!-- Article View -->
            <div id="article-view" class="max-w-2xl sm:max-w-3xl md:max-w-4xl mx-auto" style="display: none;">
                <div class="bg-white rounded-lg shadow p-3 sm:p-4 md:p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-3 sm:mb-4 md:mb-6">
                        <h2 class="text-xl sm:text-2xl font-semibold">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è</h2>
                        <button id="back-to-form" class="px-3 sm:px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm sm:text-base">
                            –ù–∞–∑–∞–¥ –∫ —Ñ–æ—Ä–º–µ
                        </button>
                    </div>
                    
                    <div id="article-content" class="prose max-w-none">
                        <!-- Article content will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- History -->
            <div id="history-view" class="max-w-2xl sm:max-w-3xl md:max-w-4xl mx-auto" style="display: none;">
                <div class="bg-white rounded-lg shadow p-3 sm:p-4 md:p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-3 sm:mb-4 md:mb-6">
                        <h2 class="text-xl sm:text-2xl font-semibold">–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç–µ–π</h2>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <button onclick="clearLocalHistory()" class="px-3 py-2 bg-red-600 text-white rounded-md text-sm hover:bg-red-700">
                                –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
                            </button>
                            <button id="back-to-form-from-history" class="px-3 sm:px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm sm:text-base">
                                –ù–∞–∑–∞–¥ –∫ —Ñ–æ—Ä–º–µ
                            </button>
                        </div>
                    </div>
                    
                    <div id="history-content">
                        <p class="text-gray-600">–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å...</p>
                    </div>
                </div>
            </div>
        </main>
        
        </main>
    </div>
    
    <!-- Footer —Å –≤–µ—Ä—Å–∏–µ–π -->
    <footer class="mt-auto py-2 sm:py-3 border-t border-gray-200 bg-white">
        <div class="px-0 sm:px-1 md:px-2">
            <div class="flex flex-col sm:flex-row justify-between items-center gap-1 sm:gap-2 text-xs sm:text-sm text-gray-500">
                <div>
                    <span>SEO Article Generator</span>
                </div>
                <div>
                    <span id="app-version">v0.1.0</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Configuration
        const API_BASE_URL = 'https://seo-article-generator-app-8a9fa9a58cbb.herokuapp.com';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –±–∏–±–ª–∏–æ—Ç–µ–∫
        window.addEventListener('load', function() {
            console.log('Axios –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof axios !== 'undefined');
            console.log('Marked –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof marked !== 'undefined');
            if (typeof marked !== 'undefined') {
                console.log('Marked –≤–µ—Ä—Å–∏—è:', marked.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ');
            }
        });
        
        // Elements
        const navGenerate = document.getElementById('nav-generate');
        const navHistory = document.getElementById('nav-history');
        const generationForm = document.getElementById('generation-form');
        const articleView = document.getElementById('article-view');
        const historyView = document.getElementById('history-view');
        const articleForm = document.getElementById('article-form');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const articleContent = document.getElementById('article-content');
        const backToForm = document.getElementById('back-to-form');
        const backToFormFromHistory = document.getElementById('back-to-form-from-history');
        const historyContent = document.getElementById('history-content');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const requiredElements = {
            navGenerate, navHistory, generationForm, articleView, historyView, 
            articleForm, loading, errorMessage, articleContent, historyContent
        };
        
        for (const [name, element] of Object.entries(requiredElements)) {
            if (!element) {
                console.error(`–≠–ª–µ–º–µ–Ω—Ç ${name} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM`);
            }
        }

        // Navigation
        navGenerate.addEventListener('click', () => showView('generation'));
        navHistory.addEventListener('click', () => showView('history'));
        backToForm.addEventListener('click', () => showView('generation'));
        backToFormFromHistory.addEventListener('click', () => showView('generation'));

        function showView(view) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –≤–∏–¥
            if (view === 'generation' || view === 'form') {
                generationForm.style.display = 'block';
                articleView.style.display = 'none';
                historyView.style.display = 'none';
            } else if (view === 'article') {
                generationForm.style.display = 'none';
                articleView.style.display = 'block';
                historyView.style.display = 'none';
            } else if (view === 'history') {
                generationForm.style.display = 'none';
                articleView.style.display = 'none';
                historyView.style.display = 'block';
            }
            
            // Update navigation
            navGenerate.className = (view === 'generation' || view === 'form') ? 'px-4 py-2 rounded-md bg-blue-600 text-white font-medium' : 'px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100';
            navHistory.className = view === 'history' ? 'px-4 py-2 rounded-md bg-blue-600 text-white font-medium' : 'px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100';
        }

        // Form submission
        articleForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                topic: document.getElementById('topic').value,
                thesis: document.getElementById('thesis').value,
                style_examples: document.getElementById('styleExamples').value,
                character_count: parseInt(document.getElementById('characterCount').value),
                model: document.getElementById('model').value
            };

            showLoading(true);
            hideError();

            try {
                const response = await axios.post(`${API_BASE_URL}/api/articles/generate`, formData);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—å—é –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–∞–∫ fallback
                const articles = JSON.parse(localStorage.getItem('articles') || '[]');
                articles.unshift(response.data);
                localStorage.setItem('articles', JSON.stringify(articles));
                
                displayArticle(response.data);
                showView('article');
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ç—å–∏: ' + (error.response?.data?.detail || error.message));
            } finally {
                showLoading(false);
            }
        });

        function displayArticle(article) {
            const content = `
                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-2">–¢–µ–º–∞: ${article.topic}</h3>
                    <div class="flex items-center space-x-4 text-sm text-gray-600">
                        <span>SEO –æ—Ü–µ–Ω–∫–∞: <span class="font-semibold text-green-600">${article.seo_score}/10</span></span>
                        <span>–ú–æ–¥–µ–ª—å: ${article.model_used}</span>
                        <span>–î–∞—Ç–∞: ${new Date(article.created_at).toLocaleDateString()}</span>
                    </div>
                </div>
                
                ${article.style_examples ? `
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–ü—Ä–∏–º–µ—Ä—ã —Å—Ç–∏–ª—è:</h4>
                    <div class="bg-blue-50 p-4 rounded-md border-l-4 border-blue-400">
                        <pre class="whitespace-pre-wrap text-sm text-gray-700">${article.style_examples}</pre>
                    </div>
                </div>
                ` : ''}
                
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞—Ç—å–∏:</h4>
                    <div class="bg-gray-50 p-4 rounded-md">
                        <pre class="whitespace-pre-wrap text-sm">${article.structure}</pre>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏:</h4>
                    <div class="prose max-w-none">
                        ${marked.parse(article.article)}
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</h4>
                    <div class="flex flex-wrap gap-2">
                        ${article.keywords.map(keyword => `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">${keyword}</span>`).join('')}
                    </div>
                </div>
                
                ${article.usage ? `
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API:</h4>
                    <div class="bg-gray-50 p-4 rounded-md">
                        <p><strong>–ú–æ–¥–µ–ª—å:</strong> ${article.usage.model || article.model_used || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                        <p><strong>–¢–æ–∫–µ–Ω—ã:</strong> ${article.usage.total_tokens || 0}</p>
                        <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> $${article.usage.cost_usd || '0.00'}</p>
                    </div>
                </div>
                ` : ''}
            `;
            
            articleContent.innerHTML = content;
        }

        function showLoading(show) {
            loading.classList.toggle('show', show);
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        // Load history
        async function loadHistory() {
            try {
                const response = await axios.get(`${API_BASE_URL}/api/articles`);
                let articles = response.data || [];
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—å–∏ –∏–∑ localStorage, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                const localArticles = JSON.parse(localStorage.getItem('articles') || '[]');
                if (localArticles.length > 0) {
                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –∏ —É–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ID
                    const allArticles = [...localArticles, ...articles];
                    const uniqueArticles = allArticles.filter((article, index, self) => 
                        index === self.findIndex(a => a.id === article.id)
                    );
                    articles = uniqueArticles.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                }
                
                displayHistory(articles);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage:', error);
                // Fallback –Ω–∞ localStorage –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
                const localArticles = JSON.parse(localStorage.getItem('articles') || '[]');
                displayHistory(localArticles);
            }
        }

        function displayHistory(articles) {
            if (articles.length === 0) {
                historyContent.innerHTML = '<p class="text-gray-600">–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç–µ–π –ø—É—Å—Ç–∞</p>';
                return;
            }

            const historyHTML = articles.map(article => `
                <div class="border-b border-gray-200 py-4 last:border-b-0">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold">${article.topic}</h3>
                            <p class="text-gray-600 text-sm mt-1">${article.thesis.substring(0, 100)}...</p>
                            <div class="flex items-center space-x-4 text-sm text-gray-500 mt-2">
                                <span>SEO: ${article.seo_score}/10</span>
                                <span>–ú–æ–¥–µ–ª—å: ${article.model_used}</span>
                                <span>–°—Ç–∏–ª—å: ${article.style_examples ? '–î–∞' : '–ù–µ—Ç'}</span>
                                <span>${new Date(article.created_at).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <button onclick="viewArticle('${article.id}')" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                            –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                    </div>
                </div>
            `).join('');

            historyContent.innerHTML = historyHTML;
        }

        function displayArticle(article) {
            const articleContentElement = document.getElementById('article-content');
            if (!articleContentElement) {
                console.error('–≠–ª–µ–º–µ–Ω—Ç article-content –Ω–µ –Ω–∞–π–¥–µ–Ω');
                showError('–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è: —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            articleContentElement.innerHTML = `
                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-2">–¢–µ–º–∞: ${article.topic}</h3>
                    <div class="flex items-center space-x-4 text-sm text-gray-600">
                        <span>SEO –æ—Ü–µ–Ω–∫–∞: <span class="font-semibold text-green-600">${article.seo_score}/10</span></span>
                        <span>–ú–æ–¥–µ–ª—å: ${article.model_used}</span>
                        <span>–ó–Ω–∞–∫–æ–≤: ${article.character_count || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</span>
                        <span>–î–∞—Ç–∞: ${new Date(article.created_at).toLocaleDateString()}</span>
                    </div>
                </div>
                
                ${article.style_examples ? `
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–ü—Ä–∏–º–µ—Ä—ã —Å—Ç–∏–ª—è:</h4>
                    <div class="bg-blue-50 p-4 rounded-md border-l-4 border-blue-400">
                        <pre class="whitespace-pre-wrap text-sm text-gray-700">${article.style_examples}</pre>
                    </div>
                </div>
                ` : ''}
                
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–¢–µ–∑–∏—Å—ã:</h4>
                    <div class="bg-gray-50 p-4 rounded-md">
                        <p class="text-gray-700">${article.thesis}</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</h4>
                    <div class="flex flex-wrap gap-2">
                        ${article.keywords.map(keyword => `<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm">${keyword}</span>`).join('')}
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞—Ç—å–∏:</h4>
                    <div class="bg-gray-50 p-4 rounded-md">
                        <pre class="whitespace-pre-wrap text-sm text-gray-700">${article.structure}</pre>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–ì–æ—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è:</h4>
                    <div class="bg-white p-4 rounded-md border prose max-w-none">
                        ${renderMarkdown(article.article)}
                    </div>
                </div>
                
                ${article.usage ? `
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenAI:</h4>
                    <div class="bg-yellow-50 p-4 rounded-md">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <span class="font-medium">–ú–æ–¥–µ–ª—å:</span><br>
                                <span class="text-gray-600">${article.usage.model || article.model_used || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</span>
                            </div>
                            <div>
                                <span class="font-medium">–¢–æ–∫–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–∞:</span><br>
                                <span class="text-gray-600">${article.usage.prompt_tokens || 0}</span>
                            </div>
                            <div>
                                <span class="font-medium">–¢–æ–∫–µ–Ω—ã –æ—Ç–≤–µ—Ç–∞:</span><br>
                                <span class="text-gray-600">${article.usage.completion_tokens || 0}</span>
                            </div>
                            <div>
                                <span class="font-medium">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span><br>
                                <span class="text-gray-600">$${article.usage.cost_usd || '0.00'}</span>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
        }

        async function viewArticle(articleId) {
            try {
                console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—å—é —Å ID:', articleId);
                showLoading(true);
                
                let article = null;
                
                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞
                try {
                    const response = await axios.get(`${API_BASE_URL}/api/articles/${articleId}`);
                    article = response.data;
                    console.log('–°—Ç–∞—Ç—å—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞:', article);
                } catch (serverError) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞, –∏—â–µ–º –≤ localStorage:', serverError.message);
                    
                    // –ò—â–µ–º –≤ localStorage
                    const localArticles = JSON.parse(localStorage.getItem('articles') || '[]');
                    article = localArticles.find(a => a.id === articleId);
                    
                    if (article) {
                        console.log('–°—Ç–∞—Ç—å—è –Ω–∞–π–¥–µ–Ω–∞ –≤ localStorage:', article);
                    }
                }
                
                if (article) {
                    console.log('–û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç—å—é:', article);
                    displayArticle(article);
                    console.log('–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∏–¥ article');
                    showView('article');
                } else {
                    showError('–°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –Ω–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.');
                }
                
                showLoading(false);
            } catch (error) {
                showLoading(false);
                console.error('–û–±—â–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç—å–∏:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç—å–∏: ' + error.message);
            }
        }

        function renderMarkdown(text) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ marked
                if (typeof marked !== 'undefined' && marked.parse) {
                    return marked.parse(text);
                } else if (typeof marked !== 'undefined' && marked) {
                    return marked(text);
                } else {
                    // Fallback: –ø—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö Markdown —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    return text
                        .replace(/^# (.*$)/gim, '<h1 class="text-2xl font-bold mb-4">$1</h1>')
                        .replace(/^## (.*$)/gim, '<h2 class="text-xl font-semibold mb-3">$1</h2>')
                        .replace(/^### (.*$)/gim, '<h3 class="text-lg font-medium mb-2">$1</h3>')
                        .replace(/^\*\*([^*]+)\*\*$/gim, '<h4 class="font-semibold mb-2">$1</h4>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        .replace(/^- (.*$)/gim, '<li class="ml-4">‚Ä¢ $1</li>')
                        .replace(/^\d+\. (.*$)/gim, '<li class="ml-4">$1</li>')
                        .replace(/\n\n/g, '</p><p class="mb-2">')
                        .replace(/^/, '<p class="mb-2">')
                        .replace(/$/, '</p>')
                        .replace(/\n/g, '<br>');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ Markdown:', error);
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç —Å –±–∞–∑–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
                return '<pre class="whitespace-pre-wrap">' + text + '</pre>';
            }
        }

        function clearLocalHistory() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞—Ç–µ–π? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                localStorage.removeItem('articles');
                loadHistory(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                alert('–õ–æ–∫–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞');
            }
        }

        // Load history when history tab is clicked
        navHistory.addEventListener('click', loadHistory);

        // Load available models from API
        async function loadModels() {
            try {
                const response = await axios.get(`${API_BASE_URL}/api/models`);
                const models = response.data.models;
                
                if (models && models.length > 0) {
                    const modelSelect = document.getElementById('model');
                    modelSelect.innerHTML = ''; // Clear current options
                    
                    // Group models by category
                    const categories = {
                        'fast': { label: 'üöÄ –ë—ã—Å—Ç—Ä—ã–µ', models: [] },
                        'balanced': { label: '‚öñÔ∏è –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ', models: [] },
                        'quality': { label: '‚≠ê –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ', models: [] },
                        'premium': { label: 'üëë –ü—Ä–µ–º–∏—É–º', models: [] }
                    };
                    
                    models.forEach(model => {
                        if (categories[model.category]) {
                            categories[model.category].models.push(model);
                        }
                    });
                    
                    // Add optgroups and options
                    Object.entries(categories).forEach(([key, category]) => {
                        if (category.models.length > 0) {
                            const optgroup = document.createElement('optgroup');
                            optgroup.label = category.label;
                            
                            category.models.forEach(model => {
                                const option = document.createElement('option');
                                option.value = model.id;
                                option.textContent = `${model.name} - ${model.description}`;
                                if (model.id === 'gpt-4o') {
                                    option.selected = true;
                                }
                                optgroup.appendChild(option);
                            });
                            
                            modelSelect.appendChild(optgroup);
                        }
                    });
                }
            } catch (error) {
                console.error('Failed to load models from API, using static list:', error);
                // Static list is already in HTML as fallback
            }
        }

        // Load models when page loads
        loadModels();

        // Load app version from API
        async function loadVersion() {
            try {
                const response = await axios.get(`${API_BASE_URL}/api/health`);
                const version = response.data.version || '0.1.0';
                document.getElementById('app-version').textContent = `v${version}`;
            } catch (error) {
                console.error('Failed to load version from API:', error);
                // Keep default version
            }
        }

        // Load version when page loads
        loadVersion();
    </script>
</body>
</html> 